# mars_video——一个大概勉强可以用的实时弹幕服务器

## 实现的功能

### 1.彩色弹幕：

每个用户会用一个int64变量保存他们的字体颜色，然后打印颜色的事情就交给前端了。（我也不知道前端的颜色信息怎么表示就用int64存了，RGB的话应该没问题）。直播时可以设置颜色，不过每次进入直播间都会采用默认颜色（暂时标为0）。

## 2.敏感词控制

在弹幕发到服务器的时候判断一下它是不是敏感词，如果是的话直接舍弃这条弹幕。考虑到敏感词可能会有很多，用了AC自动机提高查询效率。

### 3.弹幕红包&红包抽奖

弹幕红包不知道是啥，可能不会做，就做了红包抽奖。在分发弹幕时也将弹幕分发给抽奖的协程（如果有），判断符合条件后，就加入用户池。多次发抽奖弹幕无效。

#### 4.黑名单

每个直播间拥有自己的协程，创建协程时，会从数据库加载黑名单存到map中，在直播间协程给每个用户分发弹幕之前会判断发送者是否在黑名单上。不过，虽然做了添加黑名单接口，不过没有为每个直播间建一个数据表，导致禁言的鉴权难以处理，暂时没有做。

### 5.屏蔽弹幕

每个用户可以按关键字屏蔽弹幕，在写入Websocket连接之前会判断弹幕是否含有关键字。用户设置的关键词并不会保留。



## 接口文档地址：

https://documenter.getpostman.com/view/12209785/T1DtdaFH



## 杂谈

写的普普通通吧，感觉也没啥亮点。。。简单的测试了一下，大概是能用了。不知道用户多起来的时候会能不能用，对高并发没啥底气。有些地方想用redis，也有些地方感觉可以用MQ做，奈何不熟练&时间不够，就放弃了。另外，由于开始时数据表没有设计好，导致后来的鉴权变的困难，下次一定注意改正。如果没有下次了的话，当我没说 /doge

